var it=n=>n.key==="Escape",Y=n=>t=>{it(t)&&(t.preventDefault(),n())};function j(n,t,e,s,o){n.value.trim().length>t?(e.textContent=s,n.classList.add("has-error"),o.disabled=!0):(e.textContent="",n.classList.remove("has-error"),o.disabled=!1)}function O(n,t,e){let s=n.value.trim()!=="",o=!n.classList.contains("has-error"),a=!t.classList.contains("has-error");e.disabled=!s||!o||!a}function Z(){let n=new Date,t={rendered:!1,localDate:new Date,prevMonthLastDate:null,calWeekDays:["\u041F\u043D","\u0412\u0442","\u0421\u0440","\u0427\u0442","\u041F\u0442","\u0421\u0431","\u0412\u0441"],calMonthName:["\u042F\u043D\u0432\u0430\u0440\u044C","\u0424\u0435\u0440\u0432\u0430\u043B\u044C","\u041C\u0430\u0440\u0442","\u0410\u043F\u0440\u0435\u043B\u044C","\u041C\u0430\u0439","\u0418\u044E\u043D\u044C","\u0418\u044E\u043B\u044C","\u0410\u0432\u0433\u0443\u0441\u0442","\u0421\u0435\u043D\u0442\u044F\u0431\u0440\u044C","\u041E\u043A\u0442\u044F\u0431\u0440\u044C","\u041D\u043E\u044F\u0431\u0440\u044C","\u0414\u0435\u043A\u0430\u0431\u0440\u044C"],daysInMonth:function(e,s){return new Date(s,e,0).getDate()},firstDay:function(){return new Date(n.getFullYear(),n.getMonth(),1)},lastDay:function(){return new Date(n.getFullYear(),n.getMonth()+1,0)},firstDayNumber:function(){let e=t.firstDay().getDay();return e===0?7:e},lastDayNumber:function(){return t.lastDay().getDay()+1},getPreviousMonthLastDate:function(){return new Date(n.getFullYear(),n.getMonth(),0).getDate()},navigateToPreviousMonth:function(){n.setMonth(n.getMonth()-1),t.attachEventsOnNextPrev()},navigateToNextMonth:function(){n.setMonth(n.getMonth()+1),t.attachEventsOnNextPrev()},navigateToCurrentMonth:function(){let e=t.localDate.getMonth(),s=t.localDate.getFullYear();n.setMonth(e),n.setYear(s),t.attachEventsOnNextPrev()},displayYear:function(){let e=document.querySelector(".calendar .calendar-year-label");e.innerHTML=n.getFullYear()},displayMonth:function(){let e=document.querySelector(".calendar .calendar-month-label");e.innerHTML=t.calMonthName[n.getMonth()]},plotSelectors:function(){let e=document.querySelector(".calendar"),s=document.createElement("div");s.classList.add("calendar-inner");let o=document.createElement("div");o.classList.add("calendar-controls");let a=document.createElement("div");a.classList.add("calendar-prev");let p=document.createElement("a");p.setAttribute("href","#");let l=document.createElementNS("http://www.w3.org/2000/svg","svg");l.setAttribute("xmlns","http://www.w3.org/2000/svg"),l.setAttribute("width","128"),l.setAttribute("height","128"),l.setAttribute("viewBox","0 0 128 128");let c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("fill","#666"),c.setAttribute("d","M88.2 3.8L35.8 56.23 28 64l7.8 7.78 52.4 52.4 9.78-7.76L45.58 64l52.4-52.4z"),l.appendChild(c),p.appendChild(l),a.appendChild(p);let r=document.createElement("div");r.classList.add("calendar-year-month");let f=document.createElement("div");f.classList.add("calendar-month-label");let L=document.createElement("div");L.textContent="-";let E=document.createElement("div");E.classList.add("calendar-year-label"),r.appendChild(f),r.appendChild(L),r.appendChild(E);let d=document.createElement("div");d.classList.add("calendar-next");let y=document.createElement("a");y.setAttribute("href","#");let m=document.createElementNS("http://www.w3.org/2000/svg","svg");m.setAttribute("xmlns","http://www.w3.org/2000/svg"),m.setAttribute("width","128"),m.setAttribute("height","128"),m.setAttribute("viewBox","0 0 128 128");let x=document.createElementNS("http://www.w3.org/2000/svg","path");x.setAttribute("fill","#666"),x.setAttribute("d","M38.8 124.2l52.4-52.42L99 64l-7.77-7.78-52.4-52.4-9.8 7.77L81.44 64 29 116.42z"),m.appendChild(x),y.appendChild(m),d.appendChild(y),o.appendChild(a),o.appendChild(r),o.appendChild(d);let b=document.createElement("div");b.classList.add("calendar-body"),s.appendChild(o),s.appendChild(b),e.appendChild(s)},plotDayNames:function(){let e=document.querySelector(".calendar .calendar-body");t.calWeekDays.forEach(s=>{let o=document.createElement("div");o.textContent=s,e.appendChild(o)})},plotDates:function(){let e=document.querySelector(".calendar .calendar-body");t.rendered||(t.plotSelectors(),t.rendered=!0),e.innerHTML="",t.plotDayNames(),t.displayMonth(),t.displayYear();let s=1,o=0;t.prevMonthLastDate=t.getPreviousMonthLastDate();let a=[],p=t.daysInMonth(n.getMonth()+1,n.getFullYear());for(let l=1;l<p;l++)if(l<t.firstDayNumber()){o+=1;let c=document.createElement("div");c.classList.add("prev-dates"),e.appendChild(c),a.push(t.prevMonthLastDate--)}else{let c=document.createElement("div");c.classList.add("number-item"),c.setAttribute("data-num",s);let r=document.createElement("a");r.classList.add("dateNumber"),r.href="#",r.textContent=s++,c.appendChild(r),e.appendChild(c)}for(let l=0;l<o+1;l++){let c=document.createElement("div");c.classList.add("number-item"),c.setAttribute("data-num",s);let r=document.createElement("a");r.classList.add("dateNumber"),r.href="#",r.textContent=s++,c.appendChild(r),e.appendChild(c)}t.highlightToday(),t.plotPrevMonthDates(a),t.plotNextMonthDates()},attachEvents:function(){let e=document.querySelector(".calendar .calendar-prev a"),s=document.querySelector(".calendar .calendar-next a"),o=document.querySelectorAll(".calendar .dateNumber");e.addEventListener("click",t.navigateToPreviousMonth),s.addEventListener("click",t.navigateToNextMonth);for(var a=0;a<o.length;a++)o[a].addEventListener("click",t.selectDate,!1)},highlightToday:function(){let e=t.localDate.getMonth()+1,s=n.getMonth()+1,o=t.localDate.getFullYear(),a=n.getFullYear();o===a&&e===s&&document.querySelectorAll(".number-item")&&document.querySelectorAll(".number-item")[n.getDate()-1].classList.add("calendar-today")},plotPrevMonthDates:function(e){e.reverse();for(let s=0;s<e.length;s++)document.querySelectorAll(".prev-dates")&&(document.querySelectorAll(".prev-dates")[s].textContent=e[s])},plotNextMonthDates:function(){let e=document.querySelector(".calendar-body").childElementCount;if(e>42){let s=49-e;t.loopThroughNextDays(s)}if(e>35&&e<=42){let s=42-e;t.loopThroughNextDays(42-e)}},loopThroughNextDays:function(e){let s=document.querySelector(".calendar-body");if(e>0)for(let o=1;o<=e;o++){let a=document.createElement("div");a.classList.add("next-dates"),a.textContent=o,s.appendChild(a)}},attachEventsOnNextPrev:function(){t.plotDates(),t.attachEvents()},init:function(){t.rendered||(t.plotSelectors(),t.rendered=!0),t.plotDates(),t.attachEvents()}};t.init()}function tt(){document.querySelectorAll(".editor").forEach(t=>{t.addEventListener("input",()=>{t.style.height="auto",t.style.height=t.scrollHeight+"px"})})}function et(n){let t=document.getElementById("dateInput"),e=document.querySelector(".calendar"),s=document.getElementById("priorityInput"),o=document.querySelector(".popup-priority"),a=document.querySelectorAll(".popup-priority__item"),p=document.querySelector(".task-editor__priority-label"),l=document.getElementById("projectInput"),c=document.querySelector(".popup-project"),r=document.querySelector(".popup-project__list"),f=document.querySelector(".popup-project_btn-reset"),L=document.querySelector(".popup-project__list-empty"),E=new Z;function d(i,u,h){return function(v){v.stopPropagation(),i.classList.contains("task-editor__popup--open")?h():u()}}if(s.addEventListener("click",d(o,k,g)),!l.closest(".list-in-project"))l.addEventListener("click",d(c,I,q));else{let i=document.querySelector(".projects-task").dataset.project;l.value=i}f.addEventListener("click",()=>{l.value="";let u=document.querySelector(".task-editor").dataset.taskId,h=document.querySelector(`.task[data-id="${u}"]`);h&&delete h.dataset.project,q()}),a.forEach(function(i){i.addEventListener("click",function(){let u=i.textContent.trim();switch(s.value=u,p.classList.remove("task-editor__priority-label--priority1","task-editor__priority-label--priority2","task-editor__priority-label--priority3"),u){case"\u0421\u0440\u043E\u0447\u043D\u043E":p.classList.add("task-editor__priority-label--priority1");break;case"\u0412\u0430\u0436\u043D\u043E":p.classList.add("task-editor__priority-label--priority2");break;case"\u0412\u0442\u043E\u0440\u043E\u0441\u0442\u0435\u043F\u0435\u043D\u043D\u043E":p.classList.add("task-editor__priority-label--priority3");break;default:break}g()})}),t.value=n,t.addEventListener("click",()=>{e.style.display==="block"?C():F()}),e.addEventListener("click",function(i){if(i.target.classList.contains("dateNumber")){let u=i.target.textContent.trim(),h=e.querySelector(".calendar-month-label").textContent.trim();t.value=`${u} ${h}`,C()}});let y=Y(g),m=Y(q),x=Y(C);function b(){C(),g(),q()}function M(i,u){b(),i.classList.add("task-editor__popup--open"),document.addEventListener("keydown",u)}function w(i,u){i.classList.remove("task-editor__popup--open"),document.removeEventListener("keydown",u)}function k(){M(o,y)}function g(){w(o,y)}function I(){M(c,m),S()}function q(){w(c,m)}function F(){b(),e.style.display="block",document.addEventListener("keydown",x)}function C(){e.style.display="none",document.removeEventListener("keydown",x)}function S(){let u=document.querySelector(".projects__list-wrapper").querySelectorAll(".project__title");r.innerHTML="",u.forEach(h=>{let v=document.createElement("li");v.classList.add("popup-project__item");let $=document.createElement("span");$.textContent=h.textContent.trim(),v.appendChild($),r.appendChild(v),v.addEventListener("click",function(){let D=v.textContent.trim();l.value=D,q()})}),T()}function T(){document.querySelectorAll(".popup-project__list li").length===0?L.style.display="block":L.style.display="none"}document.addEventListener("click",function(i){!o.contains(i.target)&&i.target!==s&&g(),!c.contains(i.target)&&i.target!==l&&q(),!e.contains(i.target)&&i.target!==t&&C()})}var St=document.querySelector(".sidebar"),Et=document.querySelectorAll(".new-item"),W=100,J=500,A={TITLE:"\u0414\u043B\u0438\u043D\u0430 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0430 \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u0430 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 100 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432.",DISC:"\u0414\u043B\u0438\u043D\u0430 \u043E\u043F\u0438\u0441\u0430\u043D\u0438\u044F \u043D\u0435 \u0434\u043E\u043B\u0436\u043D\u0430 \u043F\u0440\u0435\u0432\u044B\u0448\u0430\u0442\u044C 500 \u0441\u0438\u043C\u0432\u043E\u043B\u043E\u0432."};var X=document.querySelector(".button-date"),V=X.querySelector(".button-date__title"),U=X.querySelector(".button-date__arrow--left"),G=X.querySelector(".button-date__arrow--right"),lt=document.querySelector(".dashboard .list-with-tasks__wrapper"),_=new Date;K();N();G.addEventListener("click",function(){G.classList.contains("button-date__arrow--disabled")||(_.setDate(_.getDate()+1),K(),N())});U.addEventListener("click",function(){U.classList.contains("button-date__arrow--disabled")||(_.setDate(_.getDate()-1),K(),N())});function K(){let n=new Date,t=new Date(n);t.setDate(t.getDate()+1),H(_,n)?V.textContent="\u0421\u0435\u0433\u043E\u0434\u043D\u044F":H(_,t)?V.textContent="\u0417\u0430\u0432\u0442\u0440\u0430":V.textContent=ut(_),dt()}function dt(){let n=new Date,t="button-date__arrow--disabled";U.classList.toggle(t,H(_,n)),G.classList.toggle(t,pt(_,n))}function N(){let n=lt.querySelectorAll(".task"),t=/(\d+)\s+(\S+)/;n.forEach(e=>{let s=e.querySelector(".task__data").textContent;if(s.trim()==="\u0411\u0435\u0437 \u0441\u0440\u043E\u043A\u0430"){e.classList.add("task--hidden");return}if(e.classList.contains("task--completed")){e.classList.add("task--hidden");return}let[,o,a]=s.match(t),p=new Date(_.getFullYear(),z(a),parseInt(o));H(_,p)?e.classList.remove("task--hidden"):e.classList.add("task--hidden")})}function ut(n){let t={weekday:"long",month:"long",day:"numeric"};return n.toLocaleDateString("ru-RU",t)}function H(n,t){return n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()}function pt(n,t){let e=new Date(t.getFullYear(),t.getMonth(),t.getDate()+7);return n>=e}function z(n){return["\u042F\u043D\u0432","\u0424\u0435\u0432","\u041C\u0430\u0440","\u0410\u043F\u0440","\u041C\u0430\u0439","\u0418\u044E\u043D","\u0418\u044E\u043B","\u0410\u0432\u0433","\u0421\u0435\u043D","\u041E\u043A\u0442","\u041D\u043E\u044F","\u0414\u0435\u043A"].indexOf(n)}var nt=document.querySelectorAll(".tasks__header-button"),ot=document.querySelector(".tasks .list-with-tasks__wrapper");nt.forEach(n=>{n.addEventListener("click",function(){nt.forEach(t=>t.classList.remove("tasks__header-button--active")),n.classList.add("tasks__header-button--active"),R(n.textContent.trim())})});function R(n){ot.querySelectorAll(".task").forEach(e=>{n==="\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u043D\u044B\u0435"?e.classList.contains("task--completed")?e.classList.remove("task--hidden"):e.classList.add("task--hidden"):n==="\u0410\u043A\u0442\u0438\u0432\u043D\u044B\u0435"?e.classList.contains("task--completed")||e.classList.contains("task--expired")?e.classList.add("task--hidden"):e.classList.remove("task--hidden"):n==="\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u043D\u044B\u0435"&&(e.classList.contains("task--expired")?e.classList.remove("task--hidden"):e.classList.add("task--hidden"))})}function mt(){let n=localStorage.getItem("completedTasks");return n?JSON.parse(n):[]}function yt(n){localStorage.setItem("expiredTasks",JSON.stringify(n))}function st(){let n=ot.querySelectorAll(".task"),t=new Date;t.setHours(0,0,0,0);let e=[],s=mt();n.forEach(o=>{let a=o.dataset.id,p=o.querySelector(".task__data").textContent.trim();if(p==="\u0411\u0435\u0437 \u0441\u0440\u043E\u043A\u0430"){o.classList.add("task--hidden");return}let[,l,c]=p.match(/(\d+)\s+(\S+)/);if(new Date(t.getFullYear(),z(c),parseInt(l)).getTime()<t.getTime()&&!s.includes(a)){o.classList.add("task--expired");let f=o.querySelector(".task__info-wrapper");if(!f.querySelector(".task__info-expired")){let E=document.createElement("span");E.classList.add("task__info-expired"),E.textContent="\u0417\u0430\u0434\u0430\u0447\u0430 \u043F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u0430",f.insertBefore(E,f.firstChild)}let L=document.querySelector(".tasks__header-button--active");L&&L.textContent!=="\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D\u043D\u044B\u0435"&&o.classList.add("task--hidden"),e.push(a)}else{o.classList.remove("task--expired");let f=o.querySelector(".task__info-expired");f&&f.remove()}}),yt(e)}function Q(n,t){localStorage.setItem(n,JSON.stringify(t))}function P(n){let t=localStorage.getItem(n);return t?JSON.parse(t):[]}function rt(n,t,e=null){document.querySelectorAll(n).forEach(o=>{o.addEventListener("click",()=>{let a=o.closest(t);if(a)if(e){let p=a.dataset.id;document.querySelectorAll(`${t}[${e}="${p}"]`).forEach(c=>{c.remove()}),at(p,!0)}else a.remove(),at(a.dataset.id,!1)})})}function at(n,t){let s=(t?P("tasks"):P("projects")).filter(o=>o.id!==n);t?Q("tasks",s):Q("projects",s)}function ft(n,t,e,s,o,a){let l=P("tasks").map(c=>c.id===n?{...c,title:t,description:e,date:s,priority:o,project:a}:c);localStorage.setItem("tasks",JSON.stringify(l))}function ht(n,t,e){let o=P("projects").map(a=>a.id===n?{...a,title:t,description:e}:a);localStorage.setItem("projects",JSON.stringify(o))}function ct(n,t,e,s,o,a){let p=document.querySelectorAll(n),l=document.querySelector(e);p.forEach(c=>{c.addEventListener("click",()=>{let r=c.closest(t);if(r.classList.add(`${t.slice(1)}--edit`),r){let f=r.dataset.id,L=r.querySelector(s).textContent.trim(),E=r.querySelector(o).textContent.trim(),d=l.content.cloneNode(!0).querySelector(".task-editor"),y=d.querySelector('[name="title_task"]'),m=d.querySelector('[name="discription_task"]'),x=d.querySelector('[name="data_task"]'),b=d.querySelector('[name="priority_task"]'),M=d.querySelector('[name="project_task"]'),w=d.querySelector(".task-editor__priority-label"),k=d.querySelector(".task-editor__submit-btn"),g=document.createElement("span"),I=document.createElement("span");y.value=L,m.value=E,g.classList.add("task-editor__error"),I.classList.add("task-editor__error"),y.parentNode.appendChild(g),m.parentNode.appendChild(I),y.addEventListener("input",()=>{j(y,W,g,A.TITLE,k),O(y,m,k)}),m.addEventListener("input",()=>{j(m,J,I,A.DISC,k),O(y,m,k)}),O(y,m,k),k.querySelector("use").setAttribute("href","icons/stack.svg#checkmark"),k.addEventListener("click",()=>{if(j(y,W,g,A.TITLE,k),j(m,J,I,A.DISC,k),y.classList.contains("has-error")||m.classList.contains("has-error"))return;let S=y.value.trim(),T=m.value.trim();if(r.querySelector(s).textContent=S,r.querySelector(o).textContent=T,a){let u=x.value.trim(),h=b.value.trim(),v=M.value.trim();document.querySelectorAll(`.task[data-id="${f}"]`).forEach(D=>{D.querySelector(".task__title").textContent=S,D.querySelector(".task__discription").textContent=T,D.querySelector(".task__data").textContent=u,D.querySelector(".task__project").textContent=v,D.dataset.project=v;let B=D.querySelector(".task__circle");B.classList.remove("task__circle--priority1","task__circle--priority2","task__circle--priority3"),h==="\u0421\u0440\u043E\u0447\u043D\u043E"?B.classList.add("task__circle--priority1"):h==="\u0412\u0430\u0436\u043D\u043E"?B.classList.add("task__circle--priority2"):h==="\u0412\u0442\u043E\u0440\u043E\u0441\u0442\u0435\u043F\u0435\u043D\u043D\u043E"&&B.classList.add("task__circle--priority3")}),ft(f,S,T,u,h,v)}else{let u=y.value.trim(),h=m.value.trim();ht(f,u,h)}d.classList.add("task-editor--hidden"),d.addEventListener("transitionend",function u(){r.classList.remove(`${t.slice(1)}--edit`),d.remove(),d.removeEventListener("transitionend",u)},{once:!0}),N(),st();let i=document.querySelector(".tasks__header-button--active");if(i){let u=i.textContent.trim();R(u)}});let F=r.closest(".list, .projects__list").querySelector(".manager-item");F.innerHTML="",F.appendChild(d),d.classList.add("task-editor--visible");let C=d.querySelector(".task-editor__close-btn");if(C&&C.addEventListener("click",()=>{d.classList.add("task-editor--hidden"),d.addEventListener("transitionend",function S(){r.classList.remove(`${t.slice(1)}--edit`),d.remove(),d.removeEventListener("transitionend",S)},{once:!0})}),a){let S=r.querySelector(".task__data").textContent.trim(),T=r.querySelector(".task__project").textContent.trim(),i=r.querySelector(".task__circle").classList.contains("task__circle--priority1")?"\u0421\u0440\u043E\u0447\u043D\u043E":r.querySelector(".task__circle").classList.contains("task__circle--priority2")?"\u0412\u0430\u0436\u043D\u043E":r.querySelector(".task__circle").classList.contains("task__circle--priority3")?"\u0412\u0442\u043E\u0440\u043E\u0441\u0442\u0435\u043F\u0435\u043D\u043D\u043E":"";x.value=S,M.value=T,b.value=i,i==="\u0421\u0440\u043E\u0447\u043D\u043E"?w.classList.add("task-editor__priority-label--priority1"):i==="\u0412\u0430\u0436\u043D\u043E"?w.classList.add("task-editor__priority-label--priority2"):i==="\u0412\u0442\u043E\u0440\u043E\u0441\u0442\u0435\u043F\u0435\u043D\u043D\u043E"&&w.classList.add("task-editor__priority-label--priority3"),et(S)}tt()}})})}function Nt(){rt(".button-delete-task",".task","data-id")}function Pt(){rt(".button-delete-project",".project")}function Ft(){ct(".button-edit-task",".task","#task-editor",".task__title",".task__discription",!0)}function Bt(){ct(".button-edit-project",".project","#project-editor",".project__title",".project__discription",!1)}export{Pt as deleteProject,Nt as deleteTask,Bt as editProject,Ft as editTask};
